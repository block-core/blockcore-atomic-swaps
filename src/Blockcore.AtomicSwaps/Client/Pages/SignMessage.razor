@page "/signmessage"

<PageTitle>Message Signing</PageTitle>

<h1>Message Signing</h1>

<p >Private key</p>

<textarea style="width:600px; height:100px"  @bind="WalletWords" @bind:event="oninput" />

<p >public key : @pubkey </p>
<p >Address : @Address </p>

<p >Data to sign</p>
<textarea style="width:600px; height:100px" @bind="SignData" @bind:event="oninput" />


<button class="btn btn-primary" @onclick="Sign">Sign Message</button>

<p >Payload</p>
<textarea style="width:600px; height:100px"  @bind="Payload" @bind:event="oninput" />


<button class="btn btn-primary" @onclick="Verify">VerifyMessage</button>

<p >Result : @Result </p>


@code {
    public string WalletWords { get; set; } = string.Empty;

    public string SignData { get; set; } = string.Empty;

    public string Payload { get; set; } = string.Empty;
    public string Address { get; set; } = string.Empty;
    public string pubkey { get; set; } = string.Empty;

    public string Result { get; set; } = string.Empty;

    private int currentCount = 0;

    NBitcoin.Key key;
    Networks.Network network;

    protected override async Task OnInitializedAsync()
    {
        key = new NBitcoin.Key();
        network = Blockcore.Networks.Networks1.Bitcoin.Mainnet();

        WalletWords = key.ToString(network);
        Address = key.PubKey.GetAddress(network).ToString();
        pubkey = key.PubKey.ToHex();
    }

    private void Sign()
    {
        Payload = key.SignMessage(SignData);
    }

    private void Verify()
    {
        var success = key.PubKey.VerifyMessage(SignData, Payload);

        Result = success.ToString();
    }
}
